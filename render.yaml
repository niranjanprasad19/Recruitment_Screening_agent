# ==============================================
# Render.com Blueprint — One-Click Cloud Deploy
# ==============================================
# Deploy: https://render.com/deploy → connect your GitHub repo
#
# After deploy, update the Frontend environment variable:
#   REACT_APP_API_URL = https://<your-backend-name>.onrender.com
# Then trigger a manual deploy on the frontend service.
# ==============================================

databases:
  - name: rsa-database
    plan: free
    databaseName: rsa_db
    user: rsa_user

services:
  # ---- Redis ----
  - type: redis
    name: rsa-redis
    plan: free
    maxmemoryPolicy: allkeys-lru
    ipAllowList: []

  # ---- FastAPI Backend ----
  - type: web
    name: rsa-backend
    plan: free
    runtime: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    healthCheckPath: /health
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: rsa-database
          property: connectionString
      - key: REDIS_URL
        fromService:
          name: rsa-redis
          type: redis
          property: connectionString
      - key: SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: "false"
      - key: BACKEND_CORS_ORIGINS
        value: "*"

  # ---- React Frontend (Static Site) ----
  - type: web
    name: rsa-frontend
    plan: static
    buildCommand: cd frontend && npm install --legacy-peer-deps && npm run build
    staticPublishPath: ./frontend/build
    headers:
      - path: /*
        name: X-Frame-Options
        value: SAMEORIGIN
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: REACT_APP_API_URL
        sync: false
